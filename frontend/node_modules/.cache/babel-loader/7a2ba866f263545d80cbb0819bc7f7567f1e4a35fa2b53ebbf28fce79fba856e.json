{"ast":null,"code":"// Trip Weather Alert Service\n// Checks saved trips and generates weather alerts one day before trip start date\n\nimport { getWeatherForecast } from './weatherForecastService';\nimport { tripAPI, tripAlertAPI } from './api';\nconst ALERTS_STORAGE_KEY = 'tripWeatherAlerts';\nconst LAST_CHECK_STORAGE_KEY = 'lastTripCheck';\n\n/**\r\n * Check for upcoming trips and generate weather alerts\r\n */\nexport const checkUpcomingTrips = async () => {\n  try {\n    // Try to get trips from API first\n    let savedTrips = [];\n    try {\n      savedTrips = await tripAPI.getAll();\n    } catch (error) {\n      console.error('Failed to load trips from API, using localStorage:', error);\n      savedTrips = JSON.parse(localStorage.getItem('savedTrips') || '[]');\n    }\n\n    // Get existing alerts\n    let alerts = [];\n    try {\n      alerts = await tripAlertAPI.getAll();\n    } catch (error) {\n      console.error('Failed to load alerts from API, using localStorage:', error);\n      alerts = JSON.parse(localStorage.getItem(ALERTS_STORAGE_KEY) || '[]');\n    }\n    const lastCheck = localStorage.getItem(LAST_CHECK_STORAGE_KEY);\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    const tomorrow = new Date(today);\n    tomorrow.setDate(tomorrow.getDate() + 1);\n\n    // Only check once per day\n    if (lastCheck === today.toISOString().split('T')[0]) {\n      return alerts;\n    }\n    const newAlerts = [];\n    for (const trip of savedTrips) {\n      // Skip if alert already sent\n      if (trip.weatherAlertSent) continue;\n      const tripStartDate = new Date(trip.startDate);\n      tripStartDate.setHours(0, 0, 0, 0);\n\n      // Check if trip starts tomorrow\n      if (tripStartDate.getTime() === tomorrow.getTime()) {\n        try {\n          // Fetch latest weather forecast\n          const forecast = await getWeatherForecast(trip.destination, 7);\n\n          // Generate weather summary\n          const currentDay = forecast.dailyForecast[0];\n          const summary = generateWeatherSummary(forecast, trip);\n\n          // Create alert data\n          const alertData = {\n            tripId: trip.id,\n            destination: trip.destination,\n            country: trip.country || '',\n            startDate: trip.startDate,\n            temperature: currentDay.maxTemp,\n            condition: currentDay.condition,\n            summary,\n            forecast: currentDay,\n            error: false\n          };\n\n          // Try to save to API\n          try {\n            await tripAlertAPI.create(alertData);\n            // Mark trip as alert sent in API\n            await tripAPI.update(trip.id, {\n              weatherAlertSent: true\n            });\n          } catch (apiError) {\n            console.error('Failed to save alert to API, using localStorage:', apiError);\n            // Fallback to localStorage\n            const alert = {\n              id: `trip-${trip.id}-${Date.now()}`,\n              tripId: trip.id,\n              destination: trip.destination,\n              country: trip.country || '',\n              startDate: trip.startDate,\n              temperature: currentDay.maxTemp,\n              condition: currentDay.condition,\n              summary,\n              forecast: currentDay,\n              createdAt: new Date().toISOString(),\n              read: false,\n              type: 'trip_reminder'\n            };\n            newAlerts.push(alert);\n            trip.weatherAlertSent = true;\n          }\n        } catch (error) {\n          console.error(`Failed to fetch weather for ${trip.destination}:`, error);\n          // Create alert without weather data\n          const alertData = {\n            tripId: trip.id,\n            destination: trip.destination,\n            country: trip.country || '',\n            startDate: trip.startDate,\n            summary: `Your trip to ${trip.destination} starts tomorrow! Weather forecast unavailable.`,\n            error: true\n          };\n          try {\n            await tripAlertAPI.create(alertData);\n            await tripAPI.update(trip.id, {\n              weatherAlertSent: true\n            });\n          } catch (apiError) {\n            console.error('Failed to save alert to API, using localStorage:', apiError);\n            const alert = {\n              id: `trip-${trip.id}-${Date.now()}`,\n              tripId: trip.id,\n              destination: trip.destination,\n              country: trip.country || '',\n              startDate: trip.startDate,\n              summary: alertData.summary,\n              createdAt: new Date().toISOString(),\n              read: false,\n              type: 'trip_reminder',\n              error: true\n            };\n            newAlerts.push(alert);\n            trip.weatherAlertSent = true;\n          }\n        }\n      }\n    }\n\n    // Update saved trips with alert sent status (localStorage fallback)\n    if (newAlerts.length > 0) {\n      try {\n        localStorage.setItem('savedTrips', JSON.stringify(savedTrips));\n      } catch (e) {\n        // Ignore localStorage errors\n      }\n\n      // Save new alerts to localStorage (fallback)\n      try {\n        const allAlerts = [...alerts, ...newAlerts].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));\n        localStorage.setItem(ALERTS_STORAGE_KEY, JSON.stringify(allAlerts));\n      } catch (e) {\n        // Ignore localStorage errors\n      }\n    }\n\n    // Update last check date\n    localStorage.setItem(LAST_CHECK_STORAGE_KEY, today.toISOString().split('T')[0]);\n\n    // Return updated alerts (try API first, then localStorage)\n    try {\n      return await tripAlertAPI.getAll();\n    } catch (error) {\n      return alerts.length > 0 ? alerts : JSON.parse(localStorage.getItem(ALERTS_STORAGE_KEY) || '[]');\n    }\n  } catch (error) {\n    console.error('Error checking upcoming trips:', error);\n    return JSON.parse(localStorage.getItem(ALERTS_STORAGE_KEY) || '[]');\n  }\n};\n\n/**\r\n * Get weather condition emoji\r\n */\nfunction getWeatherConditionEmoji(condition) {\n  const emojis = {\n    sunny: 'â˜€ï¸',\n    'partly-cloudy': 'â›…',\n    cloudy: 'â˜ï¸',\n    rainy: 'ðŸŒ§ï¸',\n    stormy: 'â›ˆï¸'\n  };\n  return emojis[condition] || 'ðŸŒ¤ï¸';\n}\n\n/**\r\n * Generate weather summary for alert\r\n */\nfunction generateWeatherSummary(forecast, trip) {\n  const currentDay = forecast.dailyForecast[0];\n  const conditionEmoji = getWeatherConditionEmoji(currentDay.condition);\n  const conditionText = currentDay.condition.charAt(0).toUpperCase() + currentDay.condition.slice(1).replace('-', ' ');\n  const tempText = currentDay.maxTemp === currentDay.minTemp ? `${currentDay.maxTemp}Â°C` : `${currentDay.minTemp}Â°C - ${currentDay.maxTemp}Â°C`;\n  let recommendation = '';\n  if (currentDay.condition === 'sunny' || currentDay.condition === 'partly-cloudy') {\n    recommendation = 'Perfect weather for sightseeing!';\n  } else if (currentDay.condition === 'rainy') {\n    recommendation = 'Pack an umbrella!';\n  } else if (currentDay.condition === 'stormy') {\n    recommendation = 'Consider indoor activities.';\n  } else {\n    recommendation = 'Weather conditions are moderate.';\n  }\n  return `${conditionEmoji} Tomorrow in ${trip.destination}: ${tempText}, ${conditionText.toLowerCase()}. ${recommendation}`;\n}\n\n/**\r\n * Get all alerts\r\n */\nexport const getAlerts = async () => {\n  try {\n    return await tripAlertAPI.getAll();\n  } catch (error) {\n    console.error('Failed to get alerts from API, using localStorage:', error);\n    return JSON.parse(localStorage.getItem(ALERTS_STORAGE_KEY) || '[]');\n  }\n};\n\n/**\r\n * Get unread alerts count\r\n */\nexport const getUnreadAlertsCount = async () => {\n  try {\n    return await tripAlertAPI.getUnreadCount();\n  } catch (error) {\n    console.error('Failed to get unread count from API, using localStorage:', error);\n    const alerts = JSON.parse(localStorage.getItem(ALERTS_STORAGE_KEY) || '[]');\n    return alerts.filter(alert => !alert.read).length;\n  }\n};\n\n/**\r\n * Mark alert as read\r\n */\nexport const markAlertAsRead = async alertId => {\n  try {\n    await tripAlertAPI.markAsRead(alertId);\n    return await getAlerts();\n  } catch (error) {\n    console.error('Failed to mark alert as read in API, using localStorage:', error);\n    const alerts = JSON.parse(localStorage.getItem(ALERTS_STORAGE_KEY) || '[]');\n    const updatedAlerts = alerts.map(alert => alert.id === alertId ? {\n      ...alert,\n      read: true\n    } : alert);\n    localStorage.setItem(ALERTS_STORAGE_KEY, JSON.stringify(updatedAlerts));\n    return updatedAlerts;\n  }\n};\n\n/**\r\n * Mark all alerts as read\r\n */\nexport const markAllAlertsAsRead = async () => {\n  try {\n    await tripAlertAPI.markAllAsRead();\n    return await getAlerts();\n  } catch (error) {\n    console.error('Failed to mark all alerts as read in API, using localStorage:', error);\n    const alerts = JSON.parse(localStorage.getItem(ALERTS_STORAGE_KEY) || '[]');\n    const updatedAlerts = alerts.map(alert => ({\n      ...alert,\n      read: true\n    }));\n    localStorage.setItem(ALERTS_STORAGE_KEY, JSON.stringify(updatedAlerts));\n    return updatedAlerts;\n  }\n};\n\n/**\r\n * Delete alert\r\n */\nexport const deleteAlert = async alertId => {\n  try {\n    await tripAlertAPI.delete(alertId);\n    return await getAlerts();\n  } catch (error) {\n    console.error('Failed to delete alert from API, using localStorage:', error);\n    const alerts = JSON.parse(localStorage.getItem(ALERTS_STORAGE_KEY) || '[]');\n    const updatedAlerts = alerts.filter(alert => alert.id !== alertId);\n    localStorage.setItem(ALERTS_STORAGE_KEY, JSON.stringify(updatedAlerts));\n    return updatedAlerts;\n  }\n};\n\n/**\r\n * Delete all alerts\r\n */\nexport const deleteAllAlerts = async () => {\n  try {\n    await tripAlertAPI.deleteAll();\n    return [];\n  } catch (error) {\n    console.error('Failed to delete all alerts from API, using localStorage:', error);\n    localStorage.setItem(ALERTS_STORAGE_KEY, JSON.stringify([]));\n    return [];\n  }\n};","map":{"version":3,"names":["getWeatherForecast","tripAPI","tripAlertAPI","ALERTS_STORAGE_KEY","LAST_CHECK_STORAGE_KEY","checkUpcomingTrips","savedTrips","getAll","error","console","JSON","parse","localStorage","getItem","alerts","lastCheck","today","Date","setHours","tomorrow","setDate","getDate","toISOString","split","newAlerts","trip","weatherAlertSent","tripStartDate","startDate","getTime","forecast","destination","currentDay","dailyForecast","summary","generateWeatherSummary","alertData","tripId","id","country","temperature","maxTemp","condition","create","update","apiError","alert","now","createdAt","read","type","push","length","setItem","stringify","e","allAlerts","sort","a","b","getWeatherConditionEmoji","emojis","sunny","cloudy","rainy","stormy","conditionEmoji","conditionText","charAt","toUpperCase","slice","replace","tempText","minTemp","recommendation","toLowerCase","getAlerts","getUnreadAlertsCount","getUnreadCount","filter","markAlertAsRead","alertId","markAsRead","updatedAlerts","map","markAllAlertsAsRead","markAllAsRead","deleteAlert","delete","deleteAllAlerts","deleteAll"],"sources":["E:/full_stack/project/weatherapp/frontend/src/services/tripAlertService.js"],"sourcesContent":["// Trip Weather Alert Service\r\n// Checks saved trips and generates weather alerts one day before trip start date\r\n\r\nimport { getWeatherForecast } from './weatherForecastService';\r\nimport { tripAPI, tripAlertAPI } from './api';\r\n\r\nconst ALERTS_STORAGE_KEY = 'tripWeatherAlerts';\r\nconst LAST_CHECK_STORAGE_KEY = 'lastTripCheck';\r\n\r\n/**\r\n * Check for upcoming trips and generate weather alerts\r\n */\r\nexport const checkUpcomingTrips = async () => {\r\n  try {\r\n    // Try to get trips from API first\r\n    let savedTrips = [];\r\n    try {\r\n      savedTrips = await tripAPI.getAll();\r\n    } catch (error) {\r\n      console.error('Failed to load trips from API, using localStorage:', error);\r\n      savedTrips = JSON.parse(localStorage.getItem('savedTrips') || '[]');\r\n    }\r\n    \r\n    // Get existing alerts\r\n    let alerts = [];\r\n    try {\r\n      alerts = await tripAlertAPI.getAll();\r\n    } catch (error) {\r\n      console.error('Failed to load alerts from API, using localStorage:', error);\r\n      alerts = JSON.parse(localStorage.getItem(ALERTS_STORAGE_KEY) || '[]');\r\n    }\r\n    \r\n    const lastCheck = localStorage.getItem(LAST_CHECK_STORAGE_KEY);\r\n    const today = new Date();\r\n    today.setHours(0, 0, 0, 0);\r\n    \r\n    const tomorrow = new Date(today);\r\n    tomorrow.setDate(tomorrow.getDate() + 1);\r\n    \r\n    // Only check once per day\r\n    if (lastCheck === today.toISOString().split('T')[0]) {\r\n      return alerts;\r\n    }\r\n    \r\n    const newAlerts = [];\r\n    \r\n    for (const trip of savedTrips) {\r\n      // Skip if alert already sent\r\n      if (trip.weatherAlertSent) continue;\r\n      \r\n      const tripStartDate = new Date(trip.startDate);\r\n      tripStartDate.setHours(0, 0, 0, 0);\r\n      \r\n      // Check if trip starts tomorrow\r\n      if (tripStartDate.getTime() === tomorrow.getTime()) {\r\n        try {\r\n          // Fetch latest weather forecast\r\n          const forecast = await getWeatherForecast(trip.destination, 7);\r\n          \r\n          // Generate weather summary\r\n          const currentDay = forecast.dailyForecast[0];\r\n          const summary = generateWeatherSummary(forecast, trip);\r\n          \r\n          // Create alert data\r\n          const alertData = {\r\n            tripId: trip.id,\r\n            destination: trip.destination,\r\n            country: trip.country || '',\r\n            startDate: trip.startDate,\r\n            temperature: currentDay.maxTemp,\r\n            condition: currentDay.condition,\r\n            summary,\r\n            forecast: currentDay,\r\n            error: false\r\n          };\r\n          \r\n          // Try to save to API\r\n          try {\r\n            await tripAlertAPI.create(alertData);\r\n            // Mark trip as alert sent in API\r\n            await tripAPI.update(trip.id, { weatherAlertSent: true });\r\n          } catch (apiError) {\r\n            console.error('Failed to save alert to API, using localStorage:', apiError);\r\n            // Fallback to localStorage\r\n            const alert = {\r\n              id: `trip-${trip.id}-${Date.now()}`,\r\n              tripId: trip.id,\r\n              destination: trip.destination,\r\n              country: trip.country || '',\r\n              startDate: trip.startDate,\r\n              temperature: currentDay.maxTemp,\r\n              condition: currentDay.condition,\r\n              summary,\r\n              forecast: currentDay,\r\n              createdAt: new Date().toISOString(),\r\n              read: false,\r\n              type: 'trip_reminder'\r\n            };\r\n            newAlerts.push(alert);\r\n            trip.weatherAlertSent = true;\r\n          }\r\n          \r\n        } catch (error) {\r\n          console.error(`Failed to fetch weather for ${trip.destination}:`, error);\r\n          // Create alert without weather data\r\n          const alertData = {\r\n            tripId: trip.id,\r\n            destination: trip.destination,\r\n            country: trip.country || '',\r\n            startDate: trip.startDate,\r\n            summary: `Your trip to ${trip.destination} starts tomorrow! Weather forecast unavailable.`,\r\n            error: true\r\n          };\r\n          \r\n          try {\r\n            await tripAlertAPI.create(alertData);\r\n            await tripAPI.update(trip.id, { weatherAlertSent: true });\r\n          } catch (apiError) {\r\n            console.error('Failed to save alert to API, using localStorage:', apiError);\r\n            const alert = {\r\n              id: `trip-${trip.id}-${Date.now()}`,\r\n              tripId: trip.id,\r\n              destination: trip.destination,\r\n              country: trip.country || '',\r\n              startDate: trip.startDate,\r\n              summary: alertData.summary,\r\n              createdAt: new Date().toISOString(),\r\n              read: false,\r\n              type: 'trip_reminder',\r\n              error: true\r\n            };\r\n            newAlerts.push(alert);\r\n            trip.weatherAlertSent = true;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Update saved trips with alert sent status (localStorage fallback)\r\n    if (newAlerts.length > 0) {\r\n      try {\r\n        localStorage.setItem('savedTrips', JSON.stringify(savedTrips));\r\n      } catch (e) {\r\n        // Ignore localStorage errors\r\n      }\r\n      \r\n      // Save new alerts to localStorage (fallback)\r\n      try {\r\n        const allAlerts = [...alerts, ...newAlerts].sort((a, b) => \r\n          new Date(b.createdAt) - new Date(a.createdAt)\r\n        );\r\n        localStorage.setItem(ALERTS_STORAGE_KEY, JSON.stringify(allAlerts));\r\n      } catch (e) {\r\n        // Ignore localStorage errors\r\n      }\r\n    }\r\n    \r\n    // Update last check date\r\n    localStorage.setItem(LAST_CHECK_STORAGE_KEY, today.toISOString().split('T')[0]);\r\n    \r\n    // Return updated alerts (try API first, then localStorage)\r\n    try {\r\n      return await tripAlertAPI.getAll();\r\n    } catch (error) {\r\n      return alerts.length > 0 ? alerts : JSON.parse(localStorage.getItem(ALERTS_STORAGE_KEY) || '[]');\r\n    }\r\n  } catch (error) {\r\n    console.error('Error checking upcoming trips:', error);\r\n    return JSON.parse(localStorage.getItem(ALERTS_STORAGE_KEY) || '[]');\r\n  }\r\n};\r\n\r\n/**\r\n * Get weather condition emoji\r\n */\r\nfunction getWeatherConditionEmoji(condition) {\r\n  const emojis = {\r\n    sunny: 'â˜€ï¸',\r\n    'partly-cloudy': 'â›…',\r\n    cloudy: 'â˜ï¸',\r\n    rainy: 'ðŸŒ§ï¸',\r\n    stormy: 'â›ˆï¸'\r\n  };\r\n  return emojis[condition] || 'ðŸŒ¤ï¸';\r\n}\r\n\r\n/**\r\n * Generate weather summary for alert\r\n */\r\nfunction generateWeatherSummary(forecast, trip) {\r\n  const currentDay = forecast.dailyForecast[0];\r\n  const conditionEmoji = getWeatherConditionEmoji(currentDay.condition);\r\n  const conditionText = currentDay.condition.charAt(0).toUpperCase() + currentDay.condition.slice(1).replace('-', ' ');\r\n  \r\n  const tempText = currentDay.maxTemp === currentDay.minTemp \r\n    ? `${currentDay.maxTemp}Â°C` \r\n    : `${currentDay.minTemp}Â°C - ${currentDay.maxTemp}Â°C`;\r\n  \r\n  let recommendation = '';\r\n  if (currentDay.condition === 'sunny' || currentDay.condition === 'partly-cloudy') {\r\n    recommendation = 'Perfect weather for sightseeing!';\r\n  } else if (currentDay.condition === 'rainy') {\r\n    recommendation = 'Pack an umbrella!';\r\n  } else if (currentDay.condition === 'stormy') {\r\n    recommendation = 'Consider indoor activities.';\r\n  } else {\r\n    recommendation = 'Weather conditions are moderate.';\r\n  }\r\n  \r\n  return `${conditionEmoji} Tomorrow in ${trip.destination}: ${tempText}, ${conditionText.toLowerCase()}. ${recommendation}`;\r\n}\r\n\r\n/**\r\n * Get all alerts\r\n */\r\nexport const getAlerts = async () => {\r\n  try {\r\n    return await tripAlertAPI.getAll();\r\n  } catch (error) {\r\n    console.error('Failed to get alerts from API, using localStorage:', error);\r\n    return JSON.parse(localStorage.getItem(ALERTS_STORAGE_KEY) || '[]');\r\n  }\r\n};\r\n\r\n/**\r\n * Get unread alerts count\r\n */\r\nexport const getUnreadAlertsCount = async () => {\r\n  try {\r\n    return await tripAlertAPI.getUnreadCount();\r\n  } catch (error) {\r\n    console.error('Failed to get unread count from API, using localStorage:', error);\r\n    const alerts = JSON.parse(localStorage.getItem(ALERTS_STORAGE_KEY) || '[]');\r\n    return alerts.filter(alert => !alert.read).length;\r\n  }\r\n};\r\n\r\n/**\r\n * Mark alert as read\r\n */\r\nexport const markAlertAsRead = async (alertId) => {\r\n  try {\r\n    await tripAlertAPI.markAsRead(alertId);\r\n    return await getAlerts();\r\n  } catch (error) {\r\n    console.error('Failed to mark alert as read in API, using localStorage:', error);\r\n    const alerts = JSON.parse(localStorage.getItem(ALERTS_STORAGE_KEY) || '[]');\r\n    const updatedAlerts = alerts.map(alert => \r\n      alert.id === alertId ? { ...alert, read: true } : alert\r\n    );\r\n    localStorage.setItem(ALERTS_STORAGE_KEY, JSON.stringify(updatedAlerts));\r\n    return updatedAlerts;\r\n  }\r\n};\r\n\r\n/**\r\n * Mark all alerts as read\r\n */\r\nexport const markAllAlertsAsRead = async () => {\r\n  try {\r\n    await tripAlertAPI.markAllAsRead();\r\n    return await getAlerts();\r\n  } catch (error) {\r\n    console.error('Failed to mark all alerts as read in API, using localStorage:', error);\r\n    const alerts = JSON.parse(localStorage.getItem(ALERTS_STORAGE_KEY) || '[]');\r\n    const updatedAlerts = alerts.map(alert => ({ ...alert, read: true }));\r\n    localStorage.setItem(ALERTS_STORAGE_KEY, JSON.stringify(updatedAlerts));\r\n    return updatedAlerts;\r\n  }\r\n};\r\n\r\n/**\r\n * Delete alert\r\n */\r\nexport const deleteAlert = async (alertId) => {\r\n  try {\r\n    await tripAlertAPI.delete(alertId);\r\n    return await getAlerts();\r\n  } catch (error) {\r\n    console.error('Failed to delete alert from API, using localStorage:', error);\r\n    const alerts = JSON.parse(localStorage.getItem(ALERTS_STORAGE_KEY) || '[]');\r\n    const updatedAlerts = alerts.filter(alert => alert.id !== alertId);\r\n    localStorage.setItem(ALERTS_STORAGE_KEY, JSON.stringify(updatedAlerts));\r\n    return updatedAlerts;\r\n  }\r\n};\r\n\r\n/**\r\n * Delete all alerts\r\n */\r\nexport const deleteAllAlerts = async () => {\r\n  try {\r\n    await tripAlertAPI.deleteAll();\r\n    return [];\r\n  } catch (error) {\r\n    console.error('Failed to delete all alerts from API, using localStorage:', error);\r\n    localStorage.setItem(ALERTS_STORAGE_KEY, JSON.stringify([]));\r\n    return [];\r\n  }\r\n};\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}